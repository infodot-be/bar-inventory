<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Bar Inventory{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    {% block extra_head %}{% endblock %}

    <style>
        body {
            padding-bottom: 60px;
            background-color: #f8f9fa;
            overscroll-behavior-y: contain;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .location-card:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }

        .stock-item {
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 0;
        }

        .stock-item:last-child {
            border-bottom: none;
        }

        .btn-adjust {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            padding: 0;
        }

        .quantity-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: #0d6efd;
        }

        .liters-display {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .htmx-indicator {
            display: none;
        }

        .htmx-request .htmx-indicator {
            display: inline-block;
        }

        .fade-in {
            animation: fadeIn 0.3s;
        }

        /* Pull to refresh indicator */
        .pull-to-refresh {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%) scale(0);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1000;
            transition: transform 0.3s ease;
            pointer-events: none;
        }

        .pull-to-refresh.show {
            transform: translateX(-50%) scale(1);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Pull to refresh indicator -->
    <div class="pull-to-refresh" id="pullToRefreshIndicator">
        <i class="bi bi-arrow-clockwise"></i> Release to refresh
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'inventory:index' %}">
                <i class="bi bi-cup-straw"></i> Bar Inventory
            </a>
            <div class="d-flex">
                {% if user.is_authenticated %}
                    {% if user.is_staff %}
                        <a href="{% url 'stock:overview' %}" class="btn btn-outline-light btn-sm me-2">
                            <i class="bi bi-bar-chart"></i> Overview
                        </a>
                    {% else %}
                        {% if user.location %}
                            <a href="{% url 'stock:overview_location' user.location.id %}" class="btn btn-outline-light btn-sm me-2">
                                <i class="bi bi-bar-chart"></i> Overview
                            </a>
                            <a href="{% url 'stock:location_detail' user.location.id %}" class="btn btn-outline-light btn-sm me-2">
                                <i class="bi bi-box-seam"></i> Stock
                            </a>
                        {% endif %}
                    {% endif %}
                {% endif %}
                {% block nav_actions %}{% endblock %}
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-4">
        {% block content %}{% endblock %}
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- HTMX CSRF Token Configuration -->
    <script>
        document.body.addEventListener('htmx:configRequest', (event) => {
            event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
        });

        // Pull to refresh functionality for mobile
        (function() {
            let startY = 0;
            let pullDistance = 0;
            const threshold = 80;
            const indicator = document.getElementById('pullToRefreshIndicator');
            let isPulling = false;

            document.addEventListener('touchstart', function(e) {
                // Only trigger if at the top of the page
                if (window.scrollY === 0) {
                    startY = e.touches[0].pageY;
                    isPulling = true;
                }
            }, { passive: true });

            document.addEventListener('touchmove', function(e) {
                if (!isPulling) return;

                const currentY = e.touches[0].pageY;
                pullDistance = currentY - startY;

                if (pullDistance > 0) {
                    e.preventDefault();

                    if (pullDistance > threshold) {
                        indicator.classList.add('show');
                        indicator.innerHTML = '<i class="bi bi-arrow-clockwise"></i> Release to refresh';
                    } else {
                        indicator.classList.remove('show');
                    }
                }
            }, { passive: false });

            document.addEventListener('touchend', function(e) {
                if (!isPulling) return;

                if (pullDistance > threshold) {
                    indicator.innerHTML = '<i class="bi bi-arrow-clockwise"></i> Refreshing...';
                    setTimeout(() => {
                        location.reload();
                    }, 300);
                } else {
                    indicator.classList.remove('show');
                }

                isPulling = false;
                pullDistance = 0;
                startY = 0;
            }, { passive: true });
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
